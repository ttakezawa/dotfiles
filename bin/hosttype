#!/bin/bash

[[ $- == *i* ]] && IS_INTERACTIVE_SH=1

case $OSTYPE in
  darwin*) IS_DARWIN=1 ;;
  linux*)  IS_LINUX=1  ;;
esac

if type -P mount.vboxsf >/dev/null; then
  IS_VBOX=1
fi

if [[ ( ! $IS_VBOX ) && $IS_LINUX && $IS_INTERACTIVE_SH ]] && type -P curl >/dev/null; then
  if $(curl --connect-timeout 0.01 -s http://169.254.169.254/1.0); then
    IS_EC2=1
  fi
fi

if [[ $IS_EC2 ]]; then
  echo -n "ec2"
elif [[ $IS_VBOX ]]; then
  echo -n "vbox"
elif [[ $IS_DARWIN ]]; then
  echo -n "mac"
elif [[ $IS_LINUX ]]; then
  echo -n "linux"
else
  echo -n "unknown"
fi
